var exec = require('sync-exec');
// var exec = require('child_process').execSync;
var fs = require('fs');
var os = require('os');
var chalk = require('chalk');

function exe(options, processOpts, cb) {
    var cmd = options.join(' ');
    console.log(chalk.green(cmd));
    var msg = exec(cmd, 60000, processOpts);
    
    if(msg.stderr) {
        console.log(chalk.red(msg.stderr));
    } else {
        if(msg.stdout) {
            console.log(chalk.gray(msg.stdout));
        }
        cb(msg.status);
    }
};



function execCmd(options, processOpts, cb) {
    var platform = os.platform();
    if (platform === 'win32') {
        // windows
        var opts = ["cmd", "/c"].concat(options);

    } else if (platform === 'darwin') {
        // mac 
        var opts = options;

    } else if (platform === 'linux') {
        //  linux
        var opts = options;
    }
    if(!processOpts) {
        processOpts = {};
    }
    if(typeof cb !== 'function') {
        cb = function(){};
    }
    exe(opts, processOpts, cb);
}

module.exports = execCmd;